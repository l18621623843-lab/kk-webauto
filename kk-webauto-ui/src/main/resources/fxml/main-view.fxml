<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>



<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.kk.ui.controller.MainController"
            prefHeight="800.0" prefWidth="1200.0">

    <!-- é¡¶éƒ¨èœå•æ  -->
    <top>
        <VBox>
            <MenuBar>
                <Menu text="æ–‡ä»¶(_F)">
                    <MenuItem text="ä¿å­˜ä»»åŠ¡" onAction="#handleSaveTask" accelerator="Ctrl+S"/>
                    <MenuItem text="åŠ è½½ä»»åŠ¡" onAction="#handleLoadTask" accelerator="Ctrl+O"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="é€€å‡º" onAction="#handleExit"/>
                </Menu>
                <Menu text="å¸®åŠ©(_H)">
                    <MenuItem text="å…³äºŽ" onAction="#handleAbout"/>
                </Menu>
            </MenuBar>

            <!-- ä»»åŠ¡é…ç½®åŒºåŸŸ -->
            <TitledPane text="ä»»åŠ¡é…ç½®" collapsible="false">
                <GridPane hgap="10" vgap="10">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>

                    <Label text="ç›®æ ‡URL:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                    <TextField fx:id="urlTextField" GridPane.rowIndex="0" GridPane.columnIndex="1"
                               GridPane.hgrow="ALWAYS"/>

                    <Label text="è¿è¡Œæ¨¡å¼:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                    <CheckBox fx:id="headlessCheckBox" text="æ— å¤´æ¨¡å¼ (åŽå°è¿è¡Œ)"
                              GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                    <columnConstraints>
                        <ColumnConstraints percentWidth="15"/>
                        <ColumnConstraints percentWidth="85"/>
                    </columnConstraints>
                </GridPane>
            </TitledPane>
        </VBox>
    </top>

    <!-- ä¸­é—´å†…å®¹åŒºåŸŸ -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            <!-- ä»»åŠ¡ç¼–è¾‘å™¨æ ‡ç­¾é¡µ -->
            <Tab text="ä»»åŠ¡ç¼–è¾‘å™¨">
                <VBox spacing="8">
                    <padding>
                        <Insets top="8" right="10" bottom="8" left="10"/>
                    </padding>

                    <ToolBar>
                        <ToggleButton fx:id="visualEditorToggle" text="å¯è§†åŒ–ç¼–æŽ’" onAction="#handleToggleVisualEditor"/>
                        <Separator/>
                        <Button text="ä»Žæ­¥éª¤åŒæ­¥åˆ°ç”»å¸ƒ" onAction="#handleSyncStepsToGraph"/>
                    </ToolBar>

                    <StackPane fx:id="editorStackPane" VBox.vgrow="ALWAYS">
                        <SplitPane fx:id="listEditorSplitPane" dividerPositions="0.5">
                            <!-- å·¦ä¾§ - æ­¥éª¤é…ç½® -->
                            <TitledPane text="æ·»åŠ æ­¥éª¤" collapsible="false">
                                <VBox spacing="10">
                                    <padding>
                                        <Insets top="10" right="10" bottom="10" left="10"/>
                                    </padding>

                                    <HBox spacing="10" alignment="CENTER_LEFT">
                                        <Label text="æ“ä½œç±»åž‹:" minWidth="80"/>
                                        <ComboBox fx:id="actionComboBox" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                    </HBox>

                                    <HBox spacing="10" alignment="CENTER_LEFT">
                                        <Label text="CSSé€‰æ‹©å™¨:" minWidth="80"/>
                                        <TextField fx:id="selectorTextField" HBox.hgrow="ALWAYS"/>
                                    </HBox>

                                    <VBox spacing="5">
                                        <Label text="å€¼/è„šæœ¬:"/>
                                        <TextArea fx:id="valueTextArea" prefRowCount="5" VBox.vgrow="ALWAYS"/>
                                    </VBox>

                                    <HBox spacing="10" alignment="CENTER">
                                        <Button fx:id="addStepButton" text="âž• æ·»åŠ åˆ°ä»»åŠ¡" onAction="#handleAddStep"
                                                HBox.hgrow="ALWAYS" maxWidth="Infinity" style="-fx-font-size: 14px;"/>
                                        <Button fx:id="cancelEditButton" text="å–æ¶ˆ" onAction="#handleCancelEdit"
                                                HBox.hgrow="ALWAYS" maxWidth="Infinity" style="-fx-font-size: 14px;"/>
                                    </HBox>
                                </VBox>
                            </TitledPane>

                            <!-- å³ä¾§ - ä»»åŠ¡æ­¥éª¤åˆ—è¡¨ -->
                            <VBox spacing="10">
                                <padding>
                                    <Insets top="10" right="10" bottom="10" left="10"/>
                                </padding>

                                <Label text="ä»»åŠ¡æ­¥éª¤åˆ—è¡¨" style="-fx-font-weight: bold;"/>
                                <ListView fx:id="stepListView" VBox.vgrow="ALWAYS" onMouseClicked="#handleStepListClick"/>

                                <HBox spacing="10" alignment="CENTER">
                                    <Button text="â¬† ä¸Šç§»" onAction="#handleMoveUp" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                    <Button text="â¬‡ ä¸‹ç§»" onAction="#handleMoveDown" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                    <Button text="ðŸ—‘ åˆ é™¤" onAction="#handleRemoveStep" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                </HBox>
                            </VBox>
                        </SplitPane>

                        <!-- å¯è§†åŒ–ç¼–è¾‘å™¨é¢æ¿ -->
                        <BorderPane fx:id="visualEditorPane" visible="false" managed="false">
                            <center>
                                <!-- å…³é”®ä¿®æ”¹: ç¡®ä¿ WebView å¡«å……æ•´ä¸ªå®¹å™¨ -->
                                <AnchorPane>
                                    <WebView fx:id="flowWebView"
                                             AnchorPane.topAnchor="0.0"
                                             AnchorPane.bottomAnchor="0.0"
                                             AnchorPane.leftAnchor="0.0"
                                             AnchorPane.rightAnchor="0.0"/>
                                </AnchorPane>
                            </center>
                        </BorderPane>
                    </StackPane>
                </VBox>
            </Tab>

            <!-- ä»»åŠ¡åŽ†å²æ ‡ç­¾é¡µ -->
            <Tab text="ä»»åŠ¡åŽ†å²">
                <TableView fx:id="taskHistoryTable">
                    <columns>
                        <TableColumn fx:id="nameColumn" text="ä»»åŠ¡åç§°" prefWidth="300"/>
                        <TableColumn fx:id="statusColumn" text="çŠ¶æ€" prefWidth="150"/>
                        <TableColumn fx:id="stepsColumn" text="æ­¥éª¤æ•°" prefWidth="100"/>
                    </columns>
                </TableView>
            </Tab>

            <!-- æ‰§è¡Œæ—¥å¿—æ ‡ç­¾é¡µ -->
            <Tab text="æ‰§è¡Œæ—¥å¿—">
                <TextArea fx:id="logTextArea" editable="false"
                          style="-fx-font-family: 'Consolas', 'Monaco', monospace;"/>
            </Tab>
        </TabPane>
    </center>

    <!-- åº•éƒ¨æŒ‰é’®åŒºåŸŸ -->
    <bottom>
        <VBox>
            <HBox spacing="10" alignment="CENTER">
                <padding>
                    <Insets top="10" right="10" bottom="10" left="10"/>
                </padding>

                <Button text="â–¶ æ‰§è¡Œä»»åŠ¡" onAction="#handleExecuteTask"
                        HBox.hgrow="ALWAYS" maxWidth="Infinity"
                        style="-fx-font-size: 14px; -fx-background-color: #4CAF50; -fx-text-fill: white;"/>
                <Button text="â¹ åœæ­¢ä»»åŠ¡" onAction="#handleStopTask"
                        HBox.hgrow="ALWAYS" maxWidth="Infinity"
                        style="-fx-font-size: 14px; -fx-background-color: #f44336; -fx-text-fill: white;"/>
                <Button text="ðŸ“‹ åŠ è½½ç¤ºä¾‹" onAction="#handleLoadDemo"
                        HBox.hgrow="ALWAYS" maxWidth="Infinity"
                        style="-fx-font-size: 14px;"/>
                <Button text="ðŸ—‘ æ¸…ç©ºåˆ—è¡¨" onAction="#handleClearSteps"
                        HBox.hgrow="ALWAYS" maxWidth="Infinity"
                        style="-fx-font-size: 14px;"/>
            </HBox>

            <!-- çŠ¶æ€æ  -->
            <Label text="å°±ç»ª" style="-fx-padding: 5; -fx-background-color: #f0f0f0;"/>
        </VBox>
    </bottom>

</BorderPane>